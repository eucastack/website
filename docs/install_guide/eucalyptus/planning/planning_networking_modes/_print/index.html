<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.100.1"><link rel=canonical type=text/html href=https://www.eucastack.io/docs/install_guide/eucalyptus/planning/planning_networking_modes/><link rel=alternate type=application/rss+xml href=https://www.eucastack.io/docs/install_guide/eucalyptus/planning/planning_networking_modes/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Plan Networking Modes | EucaStack</title><meta name=description content="Plan Networking Modes
These networking modes are designed to allow you to choose an appropriate level of security and flexibility for your cloud. The â€¦"><meta property="og:title" content="Plan Networking Modes"><meta property="og:description" content="An open source AWS-compatible hybrid cloud powered by Eucalyptus"><meta property="og:type" content="website"><meta property="og:url" content="https://www.eucastack.io/docs/install_guide/eucalyptus/planning/planning_networking_modes/"><meta property="og:site_name" content="EucaStack"><meta itemprop=name content="Plan Networking Modes"><meta itemprop=description content="An open source AWS-compatible hybrid cloud powered by Eucalyptus"><meta name=twitter:card content="summary"><meta name=twitter:title content="Plan Networking Modes"><meta name=twitter:description content="An open source AWS-compatible hybrid cloud powered by Eucalyptus"><link rel=preload href=/scss/main.min.dbc832a6b41f9cb352db274e4a5e4f9087c9f9f914bcd919a25e9dad92d530f3.css as=style><link href=/scss/main.min.dbc832a6b41f9cb352db274e4a5e4f9087c9f9f914bcd919a25e9dad92d530f3.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-00000000-0','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg viewBox="0 0 1388.9 333.38" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g transform="translate(-136.21 41.582)"><path transform="matrix(.26458 0 0 .26458 136.21 -41.582)" d="m1616.4 487.23c-38.46.0-73.324 9.8216-104.59 29.467s-55.615 47.177-73.047 82.594c-17.155 35.14-25.732 75.123-25.732 119.95v12.451c0 66.96 19.782 120.64 59.35 161.04 39.844 40.12 91.725 60.18 155.64 60.18 37.354.0 70.971-7.3314 100.85-21.996 30.16-14.941 54.232-35.833 72.217-62.672l-54.369-51.879c-29.053 37.354-66.683 56.029-112.89 56.029-32.926.0-60.319-10.791-82.178-32.373-21.582-21.582-33.896-50.911-36.939-87.988h293.43v-40.674c0-71.387-16.741-126.59-50.221-165.6-33.203-39.014-80.378-58.52-141.53-58.52zm927.61.0c-63.086.0-112.89 20.613-149.41 61.84-36.523 40.951-54.785 95.598-54.785 163.94v10.377c0 71.663 18.399 127.83 55.199 168.51 36.8 40.674 86.605 61.01 149.41 61.01 32.373.0 62.532-7.0547 90.478-21.166 27.946-14.111 50.081-33.203 66.406-57.275 16.325-24.349 25.042-50.497 26.148-78.443h-95.045c-1.1067 21.582-9.9609 39.706-26.562 54.371-16.602 14.665-37.491 21.996-62.67 21.996-33.203.0-58.659-11.898-76.367-35.693-17.432-24.072-26.148-60.456-26.148-109.15v-16.188c.2767-48.145 9.2702-83.975 26.978-107.49 17.708-23.796 42.887-35.695 75.537-35.695 25.456.0 46.345 8.3008 62.67 24.902 16.602 16.602 25.456 37.77 26.562 63.502h95.045c-1.6602-50.635-19.368-91.448-53.125-122.44-33.48-31.266-76.921-46.898-130.32-46.898zm439.94.0c-34.587.0-65.992 6.0872-94.215 18.262-27.946 12.174-50.081 29.053-66.406 50.635-16.325 21.305-24.486 44.271-24.486 68.896h100.85c0-17.708 7.3333-32.236 21.998-43.58 14.665-11.621 33.48-17.432 56.445-17.432 26.562.0 46.345 7.0566 59.35 21.168 13.004 13.835 19.508 32.373 19.508 55.615v29.469h-61.842c-66.13.0-117.04 12.865-152.73 38.598-35.417 25.456-53.125 62.118-53.125 109.99.0 37.907 14.251 69.727 42.75 95.459s65.299 38.598 110.4 38.598c46.484.0 85.775-16.739 117.87-50.219 3.3203 19.369 7.194 33.34 11.621 41.918h102.93v-7.0547c-11.344-24.072-17.018-56.308-17.018-96.705v-202.54c-.8301-47.868-16.878-84.945-48.144-111.23-31.266-26.563-73.184-39.844-125.76-39.844zm-1099.9 8.3008v290.94c0 53.955 12.451 95.182 37.354 123.68 25.179 28.499 62.118 42.748 110.82 42.748 54.508.0 96.566-17.432 126.17-52.295l2.4903 43.994h95.045v-449.07h-100.86v322.49c-17.155 35.14-50.221 52.709-99.195 52.709-47.314.0-70.971-28.499-70.971-85.498v-289.7h-100.86zm-268.12 72.631c27.946.0 49.805 8.7168 65.576 26.148 15.772 17.155 24.765 42.611 26.978 76.367v7.4707h-192.16c4.7038-34.587 15.495-61.563 32.373-80.932 17.155-19.369 39.567-29.055 67.236-29.055zm1386.6 165.6h54.371v84.668c-8.8542 16.325-22.135 29.329-39.844 39.014-17.432 9.6842-36.109 14.527-56.031 14.527-21.582.0-38.874-5.6732-51.879-17.018-12.728-11.621-19.092-27.116-19.092-46.484.0-23.796 9.4075-42.195 28.223-55.199 18.815-13.005 46.898-19.508 84.252-19.508z" fill="#fff"/><path transform="matrix(.26458 0 0 .26458 136.21 -41.582)" d="m4889.8 307.1v637.5h100.85V798.09l44.824-46.07 133.23 192.58h116.62l-184.69-261.89 166.85-187.18h-121.19l-124.1 139.87-31.543 39.43V307.11h-100.85zm-1162.1 79.271v109.16h-73.877v74.707h73.877v254.42c0 85.498 38.737 128.25 116.21 128.25 21.305.0 43.441-3.181 66.406-9.5449v-78.027c-11.898 2.7669-23.656 4.1504-35.277 4.1504-17.432.0-29.606-3.7364-36.523-11.207-6.6406-7.7474-9.9609-20.199-9.9609-37.354v-250.68h79.272v-74.707h-79.272v-109.16h-100.86zm-296.34 100.86c-50.358.0-91.862 13.005-124.51 39.014-32.65 26.009-48.975 58.382-48.975 97.119.0 46.208 25.179 81.487 75.537 105.84 22.965 11.068 51.602 20.199 85.912 27.393 34.31 7.194 58.798 15.495 73.463 24.902 14.942 9.4076 22.412 23.103 22.412 41.088.0 16.325-6.9174 29.606-20.752 39.844-13.835 9.9609-34.033 14.941-60.596 14.941-27.392.0-49.39-6.3639-65.992-19.092-16.602-13.005-25.593-31.404-26.977-55.199h-97.949c0 26.839 8.0241 51.879 24.072 75.121 16.048 23.242 38.46 41.504 67.236 54.785s61.563 19.922 98.363 19.922c54.232.0 98.088-12.451 131.57-37.354 33.48-25.179 50.221-57.966 50.221-98.363.0-24.072-5.5338-44.548-16.602-61.426-10.791-16.878-27.532-31.266-50.221-43.164-22.412-12.174-53.402-22.551-92.969-31.129-39.567-8.8542-65.853-17.569-78.857-26.146-13.005-8.5775-19.508-20.615-19.508-36.109.0-17.155 6.9173-30.852 20.752-41.09 14.112-10.238 32.236-15.355 54.371-15.355 23.795.0 42.887 6.5013 57.275 19.506 14.388 12.728 21.582 28.776 21.582 48.145h100.86c0-42.334-16.602-76.781-49.805-103.34-32.926-26.563-76.23-39.844-129.91-39.844zm733.79.0c-34.587.0-65.99 6.0872-94.213 18.262-27.946 12.174-50.081 29.053-66.406 50.635-16.325 21.305-24.488 44.271-24.488 68.896h100.86c0-17.708 7.3313-32.236 21.996-43.58 14.665-11.621 33.48-17.432 56.445-17.432 26.562.0 46.347 7.0566 59.352 21.168 13.005 13.835 19.506 32.373 19.506 55.615v29.469h-61.84c-66.13.0-117.04 12.865-152.73 38.598-35.417 25.456-53.125 62.118-53.125 109.99.0 37.907 14.249 69.727 42.748 95.459 28.499 25.732 65.3 38.598 110.4 38.598 46.484.0 85.775-16.739 117.87-50.219 3.3202 19.369 7.194 33.34 11.621 41.918h102.93v-7.0547c-11.344-24.072-17.016-56.308-17.016-96.705v-202.54c-.83-47.868-16.878-84.945-48.144-111.23-31.266-26.563-73.186-39.844-125.76-39.844zm464.84.0c-63.086.0-112.89 20.613-149.41 61.84-36.524 40.951-54.785 95.598-54.785 163.94v10.377c0 71.663 18.401 127.83 55.201 168.51 36.8 40.674 86.605 61.01 149.41 61.01 32.373.0 62.532-7.0547 90.479-21.166 27.946-14.111 50.081-33.203 66.406-57.275 16.325-24.349 25.042-50.497 26.148-78.443h-95.045c-1.1066 21.582-9.9608 39.706-26.562 54.371-16.601 14.665-37.493 21.996-62.672 21.996-33.203.0-58.659-11.898-76.367-35.693-17.432-24.072-26.146-60.456-26.146-109.15V711.36c.2769-48.145 9.2682-83.975 26.976-107.49 17.708-23.796 42.888-35.695 75.537-35.695 25.456.0 46.347 8.3008 62.672 24.902 16.602 16.602 25.456 37.77 26.562 63.502h95.045c-1.6602-50.635-19.37-91.448-53.127-122.44-33.48-31.266-76.921-46.898-130.32-46.898zm-446.17 246.53h54.369v84.668c-8.8541 16.325-22.135 29.329-39.844 39.014-17.432 9.6842-36.107 14.527-56.029 14.527-21.582.0-38.876-5.6732-51.881-17.018-12.728-11.621-19.092-27.116-19.092-46.484.0-23.796 9.4075-42.195 28.223-55.199 18.815-13.005 46.9-19.508 84.254-19.508z" fill="#8bc13a"/></g><g transform="translate(9.5814 7.9375)"><path transform="scale(.26458)" d="m560.34-22.102-558.42 231.31c-21.06 8.7235-38.133 34.275-38.133 57.07v688.09c0 11.398 8.5364 24.173 19.067 28.535l577.49 239.2c10.53 4.3617 27.603 4.3617 38.133.0l558.42-231.31c21.06-8.7235 38.133-34.275 38.133-57.07v-688.09c0-11.398-8.5364-24.173-19.067-28.535l-577.49-239.2c-10.53-4.3617-27.603-4.3617-38.133.0z" fill="#fff"/></g><g transform="translate(-1331.7 150.96)"><g transform="translate(-.13227 -.14313)"><path transform="scale(.26458)" d="m5651.4-517.82c-4.3107-.18795-9.0505.68347-14.025 2.7441l-507.35 210.15c-19.9 8.2427-36.031 32.385-36.031 53.924v642c0 11.537 4.7163 19.84 12.072 23.934v.06641l1.0156.41992c1.147.55934 2.2859 1.1151 3.5469 1.4688l116.15 48.111v-90l410.6-170.08c19.9-8.2427 36.031-32.385 36.031-53.924v-581l108.64 45v-80l-120.26-49.812c-3.0346-1.7765-6.523-2.8394-10.385-3.0078z" fill="#8bc13a"/><path d="m1379.7 116.68V-53.18c0-5.6989 4.2682-12.087 9.5333-14.268l134.24-55.602c5.2651-2.1809 9.5333.67105 9.5333 6.3699v169.86c0 5.6989-4.2682 12.087-9.5333 14.268l-134.24 55.602c-5.2651 2.1809-9.5333-.67105-9.5333-6.3699z" fill="#003556"/><path transform="scale(.26458)" d="m5856.6-432.82c-4.3107-.18795-9.0505.68347-14.025 2.7441l-507.35 210.15c-19.9 8.2427-36.031 32.385-36.031 53.924v642c0 11.536 4.7155 19.84 12.07 23.934v.06641l1.0352.42969c1.1397.55448 2.2713 1.1073 3.5234 1.459l116.15 48.111v-90l410.6-170.08c19.9-8.2427 36.031-32.385 36.031-53.924v-561l108.64 45v-1e2l-120.26-49.812c-3.0347-1.7765-6.525-2.8394-10.387-3.0078z" fill="#8bc13a"/><path d="m1434 139.17V-30.69c0-5.6989 4.2682-12.087 9.5333-14.268l134.24-55.602c5.2651-2.1809 9.5333.67105 9.5333 6.3699v169.86c0 5.6989-4.2682 12.087-9.5333 14.268l-134.24 55.602c-5.2651 2.1809-9.5333-.67105-9.5333-6.3699z" fill="#003556"/><path transform="scale(.26458)" d="m6061.8-347.82c-4.3107-.18795-9.0505.68347-14.025 2.7441l-507.35 210.15c-19.9 8.2427-36.031 32.385-36.031 53.924v642c1e-4 11.537 4.7163 19.84 12.072 23.934v.06641l1.0156.41992c1.147.55934 2.2859 1.1151 3.5469 1.4688l116.15 48.111v-90l410.6-170.08c19.9-8.2427 36.031-32.385 36.031-53.924v-561l108.64 45v-1e2l-120.25-49.811c-3.036-1.7784-6.5287-2.8413-10.393-3.0098z" fill="#8bc13a"/><path d="m1488.3 161.66v-169.86c0-5.6989 4.2682-12.087 9.5333-14.268l134.24-55.602c5.2651-2.1809 9.5333.67105 9.5333 6.3699v169.86c0 5.6989-4.2682 12.087-9.5333 14.268l-134.24 55.602c-5.2651 2.1809-9.5333-.67105-9.5333-6.3699z" fill="#003556"/><path d="m1520.2-14.532 89.523-37.082c5.2651-2.1809 9.5333.67105 9.5333 6.3699v135.47c0 5.6989-4.2682 12.087-9.5333 14.268l-89.523 37.082c-5.2651 2.1809-9.5333-.67104-9.5333-6.3699v-135.47c0-5.6989 4.2682-12.087 9.5333-14.268z" fill="#fff"/><path d="m1596.9 85.99-63.876 26.458-1e-4-46.302 49.504-20.505V29.766l-49.504 20.505 1e-4-46.302 63.876-26.458z" fill="#8bc13a"/></g></g></svg></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><i class='fas fa-book'></i><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><i class='fas fa-rss'></i><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/community/><i class='fas fa-users'></i><span>Community</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this siteâ€¦" aria-label="Search this siteâ€¦" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/install_guide/eucalyptus/planning/planning_networking_modes/>Return to the regular view of this page</a>.</p></div><h1 class=title>Plan Networking Modes</h1><ul><li>1: <a href=#pg-9e803e1e2ff2aef49d537ffcdab263e0>About Eucanetd</a></li><ul></ul><li>2: <a href=#pg-4a09021661db136481b10bdbcfcadf33>Understanding Eucalyptus EDGE Mode</a></li><ul></ul><li>3: <a href=#pg-89eeb5c8d44418651392426591292fef>Understanding VPCMIDO and MidoNet</a></li><ul></ul></ul><div class=content><h1 id=plan-networking-modes>Plan Networking Modes</h1><p>These networking modes are designed to allow you to choose an appropriate level of security and flexibility for your cloud. The purpose is to direct Eucalyptus to use different network features to manage the virtual networks that connect VMs to each other and to clients external to Eucalyptus .</p><p>Eucalyptus networking modes are generally modeled after AWS networking capabilities. In legacy AWS accounts, you have the ability to choose EC2 Classic network mode or VPC network mode. New AWS accounts do not have this flexibility and are forced into using VPC. Eucalyptus VPCMIDO mode is similar to AWS VPC in that it allows users to fully manage their cloud network, including the definition of a Classless Inter-Domain Routing (CIDR) block, subnets, and security groups with rules for additional protocols beyond the default three (UDP, TCP, and ICMP) available in EC2 Classic networking.</p><p>Your choice of networking mode depends on the following considerations:</p><ul><li>Does your cloud need to mimic behavior in your AWS account? If you need EC2-Classic behavior, select EDGE mode. If you need EC2-VPC behavior, select VPCMIDO mode.</li><li>Do you need to create security group rules with additional protocols (e.g., all protocols, RDP, XTP, etc.)? If so, choose VPCMIDO mode.</li><li>If there is no specific requirement for either mode, then VPCMIDO mode is recommended given its flexibility and networking features.</li></ul><p>Each networking mode is described in the following sections.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-9e803e1e2ff2aef49d537ffcdab263e0>1 - About Eucanetd</h1><p>The eucanetd service implements artifacts to manage and define Eucalyptus cloud networking. Eucanetd runs alongside the CLC or NC services, depending on the configured networking mode. Eucanetd manages network functionality. For example:</p><ul><li>Installs network artifacts (iptables, ipsets, ebtables, dhcpd)</li><li>Performs state management for the installed network artifacts</li><li>Updates network artifact configuration as needed</li><li>In VPCMIDO mode:<ul><li>Interacts with MidoNet via the MidoNet API</li><li>Defines network artifacts in MidoNet</li></ul></li></ul><h2 id=where-to-deploy-eucanetd>Where to deploy eucanetd</h2><p>Deploy <em>eucanetd</em> depending on the selected network mode:</p><table><thead><tr><th style=text-align:left>Host Machine</th><th style=text-align:left>EDGE mode</th><th style=text-align:left>VPCMIDO mode</th></tr></thead><tbody><tr><td style=text-align:left>CLC</td><td style=text-align:left>No</td><td style=text-align:left>Yes</td></tr><tr><td style=text-align:left>NC</td><td style=text-align:left>Yes</td><td style=text-align:left>No</td></tr></tbody></table><p>When required for a mode <em>eucanetd</em> should be deployed on all hosts for that service.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4a09021661db136481b10bdbcfcadf33>2 - Understanding Eucalyptus EDGE Mode</h1><p>In EDGE networking mode, the components responsible for implementing Eucalyptus VM networking artifacts are running at the edge of a Eucalyptus deployment: the Linux host machines acting as Node Controllers (NCs). On each NC host machine, a Eucalyptus stand-alone service, eucanetd, runs side-by-side with the NC service. The eucanetd service receives dynamically changing Eucalyptus networking views and is responsible for configuring the Linux networking subsystem to reflect the latest view.</p><p>EDGE networking mode integrates with your existing network infrastructure, allowing you to inform Eucalyptus , through configuration parameters for EDGE mode, about the existing network, which Eucalyptus then will consume when implementing the networking view.</p><p>EDGE networking mode integrates with two basic types of pre-existing network setups:</p><ul><li>One flat IP network used to service component systems, VM public IPs (elastic IPs), and VM private IPs.</li><li>Two networks, one for components and VM public IPs, and the other for VM private IPs.</li></ul><div class="alert alert-success" role=alert><h4 class=alert-heading>Note</h4>EDGE networking mode integrates with networks that already exist. If the network, netmask, and router don&rsquo;t already exist, you must create them outside before configuring EDGE mode.</div><h2 id=edge-mode-requirements>EDGE Mode Requirements</h2><ul><li>Each NC host machine must have an interface configured with an IP on a VM public and a VM private network (which can be the same network).</li><li>There must be IP connectivity from each NC host machine (where eucanetd runs) and the CLC host machine, so that network path from instances to the metadata server (running on the CLC host machine) can be established.</li><li>There must be a functioning router in place for the private network. This router will be the default gateway for VM instances.</li><li>The private and public networks can be the same network, but they can also be separate networks.</li><li>The NC host machines need a bridge configured on the private network, with the bridge interface itself having been assigned an IP from the network.</li><li>If you&rsquo;re using a public network, the NC host machines need an interface on the public network as well (if the public and private networks are the same network, then the bridge needs an IP assigned on the network).</li><li>If you run multiple zones, each zone can use the same network as its private network, or they can use separate networks as private networks. If you use separate networks, you need to have a router in place that is configured to route traffic between the networks.</li><li>If you use private addressing only, the CLC host machine must have a route back to the VM private network.</li></ul><h2 id=edge-mode-limitations>EDGE Mode Limitations</h2><ul><li>Global network updates (such as security group rule updates, security group VM membership updates, and elastic IP updates) are applied through an &ldquo;eventually consistent&rdquo; mechanism, as opposed to an &ldquo;atomic&rdquo; mechanism. That is, there may be a brief period of time where one NC has the new state implemented but another NC has the previous state implemented.</li><li>Mappings between VM MAC addresses and private IPs are strictly enforced. This means that instances cannot communicate using addresses the cloud has not assigned to them.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-89eeb5c8d44418651392426591292fef>3 - Understanding VPCMIDO and MidoNet</h1><p>This topic describes MidoNet components and their Eucalyptus deployment options, which provide support for VPC on Eucalyptus. Eucalyptus VPCMIDO mode resembles the Amazon Virtual Private Cloud (VPC) product wherein the network is fully configurable by users. In Eucalyptus, it is implemented with a Software-Defined Networking (SDN) technology called MidoNet. MidoNet is a network virtualization platform for Infrastructure-as-a-Service (IaaS) clouds that implements and exposes virtual network components as software abstractions, enabling programmatic provisioning of virtual networks.</p><p>This network mode requires configuration of MidoNet in order to make cloud networking functional. It offers the most advanced networking capabilities and therefore it is recommended to be used on all new Eucalyptus installations.</p><h2 id=midonet-components>MidoNet Components</h2><p>A MidoNet deployment consists of four types of nodes (according to their logical functions or services offered), connected via four IP networks as depicted in Figure 1. MidoNet does not require any specific hardware, and can be deployed in commodity x86_64 servers. Interactions with MidoNet are accomplished through Application Programming Interface (API) calls, which are translated into (virtual) network topology changes. Network state information is stored in a logically centralized data store, called the Network State Database (NSDB), which is implemented on top of two open-source distributed coordination and data store technologies: ZooKeeper and Cassandra. Implementation of (virtual) network topology is realized via cooperation and coordination among MidoNet agents, which are deployed in nodes that participate in MidoNet.</p><p><img src=https://www.eucastack.io/images/euca_mido_1v2.png alt=image>
<em>Figure 1: Logical view of a MidoNet deployment. Four components are connected via four networks.</em></p><p>Node types:</p><ul><li>MidoNet Network State Database (NSDB): consists of a cluster of ZooKeeper and Cassandra. All MidoNet nodes must have IP connectivity with NSDB.</li><li>MidoNet API: consists of MidoNet web app. Exposes MidoNet REST APIs.</li><li>Hypervisor: MidoNet agent (Midolman) are required in all Hypervisors to enable VMs to be connected via MidoNet overlay networks/SDN.</li><li>Gateway: Gateway nodes are connected to the public network, and enable the network flow from MidoNet overlays to the public network.</li></ul><p>Physical Networks:</p><ul><li>NSDB: IP network that connects all nodes that participate in MidoNet. While NSDB and Tunnel Zone networks can be the same, it is recommended to have an isolated (physical or VLAN) segment.</li><li>API: in deployments only eucanetd/CLC needs access to the API network. Only &ldquo;special hosts/processes&rdquo; should have access to this network. The use of &ldquo;localhost&rdquo; network on the node running CLC/eucanetd is sufficient and recommended in deployments.</li><li>Tunnel Zone: IP network that transports the MidoNet overlay traffic ( VM traffic), which is not &ldquo;visible&rdquo; on the physical network.</li><li>Public network: network with access to the Internet (or corporate/enterprise) network.</li></ul><h2 id=midonet-deployment-scale>MidoNet Deployment Scale</h2><p>Three reference architectures are presented in this document, ordered by complexity and size:</p><ul><li>Proof-of-Concept (PoC)</li><li>Production: Small</li><li>Production: Large</li></ul><p>Production: Large reference architecture represents the most complete and recommended deployment model of MidoNet for Eucalyptus. Whenever possible (such as when resources are available), deployments should closely match with the Production: Large reference architecture (even on small scale clouds).</p><p>All MidoNet components are designed and implemented to horizontally scale. Therefore, it is possible to start small and add resources as they become available.</p><h2 id=eucalyptus-with-midonet>Eucalyptus with MidoNet</h2><p>A Eucalyptus with MidoNet deployment consists of the following components:</p><p><img src=https://www.eucastack.io/images/euca_mido_2.png alt=image>
<em>Figure 2: Logical view of a Eucalyptus with MidoNet deployment. VM private network is created/virtualized by MidoNet, and &lsquo;software-defined&rsquo; by eucanetd. Ideally, each component and network should have its own set of independent resources. In practice, components are grouped and consolidated into a set of servers, as detailed in different reference architectures.</em></p><p>MidoNet components, Eucalyptus components, and three extra networks are present.</p><h2 id=proof-of-concept-poc>Proof of Concept (PoC)</h2><p>The PoC reference architecture is designed for very small and transient workloads, typical in development and testing environments. Quick deployment with minimal external network requirements are the key points of PoC reference architecture.</p><p><strong>Requirements</strong></p><p>Servers:</p><ul><li>Four (4) or more modern Intel cores or AMD modules - exclude logical cores that share CPU resources from the count (Hyperthreads and AMD cores within a module)</li><li>2GB of RAM reserved for MidoNet Agent (when applicable)</li><li>4GB of RAM reserved for MidoNet NSDB (when applicable)</li><li>4GB of RAM reserved for MidoNet API (when applicable)</li><li>30GB of free disk space for NSDB (when applicable)</li></ul><p>Physical Network:</p><ul><li>One (1) 1Gbps IP Network</li><li>A range or list of public IP addresses (Euca_public_IPs)</li><li>Internet Gateway</li></ul><p>Limits:</p><ul><li>Ten (10) MidoNet agents (i.e., 1 Gateway node, 1 CLC, and 8 NCs)</li><li>One (1) MidoNet Gateway</li><li>No fail over, fault tolerance, and/or network load balancing/sharing</li></ul><p><strong>Deployment Topology</strong></p><ul><li>Single server with all MidoNet components (NSDB, API, and Midolman), and with CLC/eucanetd</li><li>A server acting as MidoNet Gateway - when BGP terminated links are used, this node must not be co-located with CLC/eucanetd (in a proxy_arp setup described below, it is possible to consolidate CLC/eucanetd with MidoNet Gateway). This is due to incompatibilities in CentOS/RHEL7 netns (used by eucanetd), and bgpd (started by Midolman when BGP links are configured).</li><li>Hypervisors with Midolman</li><li>One IP network handling NSDB, Tunnel Zone, and Public Network traffic</li><li>API communication via loopback/localhost network</li></ul><p><img src=https://www.eucastack.io/images/euca_mido_3v2.png alt=image>
<em>Figure 3: PoC deployment topology. A single IP network carries NSDB, Tunnel Zone, and Public Network traffic. A single server handles MidoNet NSDB, API (and possibly Gateway) functionality.</em></p><p><strong>MidoNet Gateway Bindings</strong></p><p>Three ways to realize MidoNet Gateway bindings are discussed below, starting with the most recommended setup.</p><p>Public CIDR block(s) allocated for Eucalyptus (Euca_Public_IPs) needs to be routed to MidoNet Gateway by the customer network - this is an environment requirement, outside of control of both MidoNet and Eucalyptus systems. One way to accomplish this is to have a BGP terminated link available. MidoNet Gateway will establish a BGP session with the customer router to: (1) advertise Euca_Public_IPs to the customer router; and (2) get the default route from the customer router.</p><p>If a BGP terminated link is not available, but the routing of Euca_Public_IPs is delegated to MidoNet Gateway (configuration of customer routing infrastructure), similar setup can be used. In such scenario, static routes are configured on the customer router (to route Euca_Public_IPs to MidoNet Gateway), and on MidoNet (to use the customer router as the default route).</p><p><img src=https://www.eucastack.io/images/euca_mido_4.png alt=image>
<em>Figure 4: How servers are bound to MidoNet in a PoC deployment with BGP. A BGP terminated link is required: the gateway node eth device is bound to MidoNet virtual router (when BGP is involved, the MidoNet Gateway and Eucalyptus CLC cannot be co-located). Virtual machine tap devices are bound to MidoNet virtual bridges.</em></p><p>If routed Euca_Public_IPs are not available, static routes on all involved nodes (L2 connectivity is required among nodes) can be used as illustrated below.</p><p><img src=https://www.eucastack.io/images/euca_mido_5.png alt=image>
<em>Figure 5: How servers are bound to MidoNet in a PoC deployment without routed Euca_Public_IPs. Clients that need communication with Euca_Public_IPs configure static routes using MidoNet Gateway as the router. MidoNet Gateway configures a static default route to customer router.</em></p><p>In the case nodes outside the public network broadcast domain (L2) needs to access Euca_Public_IPs, a setup using proxy_arp, as illustrated below, can be used.</p><p><img src=https://www.eucastack.io/images/euca_mido_6.png alt=image>
<em>Figure 6: How servers are bound to MidoNet in a PoC deployment with proxy_arp. When routed Euca_Public_IPs are not available, the gateway node should proxy arp for public IP addresses allocated for Eucalyptus , and forward to a veth device that is bound to a MidoNet virtual router. Virtual machine tap devices are bound to MidoNet virtual bridges.</em></p><h2 id=production-small>Production: Small</h2><p>The Production: Small reference architecture is designed for small scale production quality deployments. It supports MidoNet NSDB fault tolerance (partial failures), and limited MidoNet Gateway failover and load balancing/sharing.</p><p>Border Gateway Protocol (BGP) terminated uplinks are recommended for production quality deployments.</p><p><strong>Requirements</strong></p><p>Servers:</p><ul><li>Four (4) or more modern Intel cores or AMD modules - exclude logical cores that share CPU resources from the count (Hyperthreads and AMD cores within a module) - for gateway nodes, 4 or more cores should be dedicated to MidoNet agent (Midolman)</li><li>4GB of RAM reserved for MidoNet Agent (when applicable), 8GB for Gateway nodes</li><li>4GB of free RAM reserved for MidoNet NSDB (when applicable)</li><li>4GB of free RAM reserved for MidoNet API (when applicable)</li><li>30GB of free disk space for NSDB (when applicable)</li><li>Two (2) 10Gbps NICs per server</li><li>Three (3) servers dedicated to MidoNet NSDB</li><li>Two (2) servers as MidoNet Gateways</li></ul><p>Physical Network:</p><ul><li>One (1) 10Gbps IP Network for public network (if upstream links are 1Gbps, this could be 1Gbps)</li><li>One (1) 10Gbps IP Network for Tunnel Zone and NSDB</li><li>Public Classless Inter-Domain Routing (CIDR) block (Euca_public_IPs)</li><li>Two (2) BGP terminated uplinks</li></ul><p>Limits:</p><ul><li>Thirty two (32) MidoNet agents (i.e., 2 Gateway nodes and 30 Hypervisors)</li><li>Two (2) MidoNet Gateways</li><li>Tolerate 1 NSDB server failure</li><li>Tolerate 1 MidoNet Gateway/uplink failure</li><li>Limited uplinks load sharing/balancing</li></ul><p><strong>Deployment Topology</strong></p><ul><li>A 3-node cluster for NSDB (co-located ZooKeeper and Cassandra)</li><li>eucanetd co-located with MidoNet API Server</li><li>Two (2) MidoNet Gateway Nodes</li><li>Hypervisors with Midolman</li><li>One 10Gbps IP network handling NSDB and Tunnel Zone traffic</li><li>One 10Gbps IP Network handling Public Network traffic</li><li>API communication via loopback/localhost network</li></ul><p><img src=https://www.eucastack.io/images/euca_mido_7v2.png alt=image>
<em>Figure 7: Production:Small deployment topology. A 10Gbps IP network carries NSDB and Tunnel Zone traffic. Another 10Gbps IP network carries Public Network traffic. A 3-node cluster for NSDB tolerates 1 server failure, and 2 gateways enable network failover and limited load balancing/sharing.</em></p><p><img src=https://www.eucastack.io/images/euca_mido_8.png alt=image>
<em>Figure 8: How servers are bound to MidoNet in a Production:Small deployment. Gateway Nodes have physical devices bound to a MidoNet virtual router. These devices should have L2 and L3 connectivity to the Customer&rsquo;s Router, and with BGP terminated links. Virtual machine tap devices are bound to MidoNet virtual bridges.</em></p><p><strong>NSDB Data Replication</strong></p><ul><li>NSDB is deployed in a cluster of 3 nodes</li><li>ZooKeeper and Cassandra both have built-in data replication</li><li>One server failure is tolerated</li></ul><p><strong>MidoNet Gateway Failover</strong></p><ul><li>Two paths are available to and from MidoNet, and failover is handled by BGP</li></ul><p><strong>MidoNet Gateway Load Balancing and Sharing</strong></p><ul><li>Load Balancing from MidoNet is implemented by MidoNet agents (Midolman): ports in a stateful port group with default routes out are used in a round-robin fashion.</li><li>Partial load sharing from the Customer&rsquo;s router to MidoNet can be accomplished by:</li></ul><h2 id=production-large>Production: Large</h2><p>The Production:Large reference architecture is designed for large scale (500 to 600 MidoNet agents) production quality deployments. It supports MidoNet NSDB fault tolerance (partial failures), and MidoNet Gateway failover and load balancing/sharing.</p><p>Border Gateway Protocol (BGP) terminated uplinks are required. Each uplink should come from an independent router.</p><p><strong>Requirements:</strong></p><ul><li>Eight (8) or more modern Intel cores or AMD modules - exclude logical cores that share CPU resources from the count (Hyperthreads and AMD cores within a module) - for gateway nodes, 8 or more cores should be dedicated to MidoNet agent (Midolman)</li><li>4GB of RAM reserved for MidoNet Agent (when applicable), 16GB for Gateway nodes</li><li>4GB of free RAM reserved for MidoNet NSDB (when applicable)</li><li>4GB of free RAM reserved for MidoNet API (when applicable)</li><li>30GB of free disk space for NSDB (when applicable)</li><li>One 1Gbps and 2 10Gbps NICs per server</li><li>Five (5) servers dedicated to MidoNet NSDB</li><li>Three (3) servers as MidoNet Gateways</li></ul><p>Physical Network:</p><ul><li>One 1Gbps IP Network for NSDB</li><li>One 10Gbps IP Network for public network (if upstream links are 1Gbps, this could be 1Gbps)</li><li>One 10Gbps IP Network for Tunnel Zone</li><li>Public Classless Inter-Domain Routing (CIDR) block (Euca_public_IPs)</li><li>Three (3) BGP terminated uplinks, each of which coming from an independent router</li><li>ZooKeeper performance recommendations:</li></ul><p>Limits:</p><ul><li>500 to 600 MidoNet agents</li><li>Three (3) MidoNet Gateways</li><li>Tolerate 1 to 2 NSDB server failures</li><li>Tolerate 1 to 2 MidoNet Gateway/uplink failures</li></ul><p><strong>Deployment Topology</strong></p><ul><li>A 5-node cluster for NSDB (co-located ZooKeeper and Cassandra)</li><li>eucanetd co-located with MidoNet API Server</li><li>Three (3) MidoNet Gateway Nodes</li><li>Hypervisors with Midolman</li><li>One 1Gbps IP network handling NSDB traffic</li><li>One 10Gbps IP network handling Tunnel Zone traffic</li><li>One 10Gbps IP network handling Public Network traffic</li><li>API communication via loopback/localhost network</li></ul><p><img src=https://www.eucastack.io/images/euca_mido_9v2.png alt=image>
<em>Figure 9: Production:Large deployment topology. A 1Gbps IP network carries NSDB; a 10Gbps IP network carries Tunnel Zone traffic; and another 10Gbps IP network carries Public Network traffic. A 5-node cluster for NSDB tolerates 2 server failures, and 3 gateways enable network failover and load balancing/sharing. Servers are bound to MidoNet in a way similar to Production:Small.</em></p><p><strong>NSDB Data Replication</strong></p><ul><li>NSDB is deployed in a cluster of 5 nodes</li><li>ZooKeeper and Cassandra both have built-in data replication</li><li>Up to 2 server failures tolerated</li></ul><p><strong>MidoNet Gateway Failover</strong></p><ul><li>Three paths are available to and from MidoNet, and failover is handled by BGP</li></ul><p><strong>MidoNet Gateway Load Balancing/Sharing</strong></p><ul><li>Load Balancing from MidoNet is implemented by MidoNet agents (Midolman): ports in a stateful port group with default routes out are used in a round-robin fashion.</li><li>The customer AS should handle multi path routing in order to support load sharing/balancing to MidoNet; for example, Equal Cost Multi Path (ECMP).</li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Community forums" aria-label="Community forums"><a class=text-white target=_blank rel=noopener href=https://github.com/orgs/eucastack/discussions aria-label="Community forums"><i class="fa fa-comments"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://twitter.com/eucastack aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/eucastack aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/eucastack aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Discord aria-label=Discord><a class=text-white target=_blank rel=noopener href=https://discord.gg/rZfweFv2dM aria-label=Discord><i class="fab fa-discord"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 EucaStack All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.c5fabd07bf74a61523c3b0406527237220f5cc80a23a9ae709f194b46828e68f.js integrity="sha256-xfq9B790phUjw7BAZScjciD1zICiOprnCfGUtGgo5o8=" crossorigin=anonymous></script></body></html>